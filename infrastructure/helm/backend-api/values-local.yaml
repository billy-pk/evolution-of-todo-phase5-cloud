# values-local.yaml
# Overrides for local Minikube deployment
# Usage: helm install backend-api ./backend-api -f values-local.yaml

# Image configuration for local development
image:
  repository: backend-api
  pullPolicy: Never  # Use local Docker images (built with `docker build`)
  tag: "latest"

# Service configuration for local development
service:
  type: ClusterIP  # Use port-forwarding in WSL (NodePort doesn't work well)
  port: 8000
  targetPort: 8000

# Dapr configuration for local development
dapr:
  enabled: true
  appId: backend-api
  appPort: 8000
  appProtocol: http
  enableMetrics: true
  metricsPort: 9090
  logLevel: debug  # Verbose logging for local debugging
  componentsPath: /dapr-components/local  # Local Dapr components (Redpanda Docker, no auth)

# Environment variables for local development
env:
  # Database connection (Neon PostgreSQL)
  # IMPORTANT: Set this value using --set-string during helm install
  # Example: helm install backend-api ./backend-api -f values-local.yaml --set-string env.DATABASE_URL="postgresql://..."
  DATABASE_URL: ""

  # Better Auth configuration (in-cluster communication)
  BETTER_AUTH_SECRET: ""  # IMPORTANT: Set this via --set-string
  BETTER_AUTH_URL: "http://frontend:3000"
  BETTER_AUTH_ISSUER: "http://frontend:3000"  # In-cluster service
  BETTER_AUTH_JWKS_URL: "http://frontend:3000/api/auth/jwks"

  # OpenAI API key
  # IMPORTANT: Set this value using --set-string during helm install
  OPENAI_API_KEY: ""

  # MCP Server configuration (separate mode - internal ClusterIP service)
  MCP_SERVER_URL: "http://mcp-server:8001"
  MOUNT_MCP_SERVER: "false"

  # Dapr ports (default Dapr sidecar ports)
  DAPR_HTTP_PORT: "3500"
  DAPR_GRPC_PORT: "50001"

  # Application configuration
  LOG_LEVEL: "debug"  # Verbose logging for local debugging
  CORS_ORIGINS: "http://localhost:30080,http://localhost:3000"  # Allow local frontend

# ConfigMap for local environment
configMap:
  enabled: true
  data:
    APP_NAME: "evolution-of-todo-backend"
    ENVIRONMENT: "local"
    DAPR_PUBSUB_NAME: "pubsub"
    DAPR_STATESTORE_NAME: "statestore"

# Resource limits for local development (reduced for Minikube)
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m  # Lower request for Minikube resource constraints
    memory: 128Mi

# Autoscaling disabled for local development
autoscaling:
  enabled: false

# Pod annotations (Dapr disabled for testing without Dapr)
podAnnotations:
  dapr.io/enabled: "false"

# Security context (relaxed for local development)
securityContext:
  runAsNonRoot: false  # Allow root for local debugging
  runAsUser: 0
  fsGroup: 0
