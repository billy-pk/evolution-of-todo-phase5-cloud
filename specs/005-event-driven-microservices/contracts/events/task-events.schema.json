{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://evolution-of-todo.example.com/schemas/task-events.schema.json",
  "title": "TaskEvent",
  "description": "Event schema for task state changes (create, update, complete, delete)",
  "type": "object",
  "required": [
    "event_type",
    "event_id",
    "task_id",
    "user_id",
    "task_data",
    "timestamp",
    "schema_version"
  ],
  "properties": {
    "event_type": {
      "type": "string",
      "enum": [
        "task.created",
        "task.updated",
        "task.completed",
        "task.deleted"
      ],
      "description": "Type of task state change event"
    },
    "event_id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this event (for idempotency and deduplication)"
    },
    "task_id": {
      "type": "string",
      "format": "uuid",
      "description": "ID of the task that changed"
    },
    "user_id": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "ID of the user who owns this task (for user isolation)"
    },
    "task_data": {
      "type": "object",
      "description": "Current state of the task after the change",
      "required": ["title", "completed"],
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500,
          "description": "Task title"
        },
        "description": {
          "type": ["string", "null"],
          "maxLength": 5000,
          "description": "Task description (optional)"
        },
        "completed": {
          "type": "boolean",
          "description": "Whether task is completed"
        },
        "priority": {
          "type": "string",
          "enum": ["low", "normal", "high", "critical"],
          "default": "normal",
          "description": "Task priority level"
        },
        "tags": {
          "type": ["array", "null"],
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 50
          },
          "maxItems": 10,
          "description": "Array of tag strings (max 10 tags)"
        },
        "due_date": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Task due date in ISO8601 format with timezone"
        },
        "recurrence_id": {
          "type": ["string", "null"],
          "format": "uuid",
          "description": "ID of recurrence rule if task is recurring (nullable)"
        }
      }
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the event occurred (ISO8601 with timezone)"
    },
    "schema_version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of this schema (e.g., 1.0.0)",
      "default": "1.0.0"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "event_type": "task.created",
      "event_id": "123e4567-e89b-12d3-a456-426614174000",
      "task_id": "550e8400-e29b-41d4-a716-446655440000",
      "user_id": "user-123",
      "task_data": {
        "title": "Weekly team meeting",
        "description": "Discuss project progress and blockers",
        "completed": false,
        "priority": "high",
        "tags": ["work", "meetings"],
        "due_date": "2026-01-13T10:00:00Z",
        "recurrence_id": "7c9e6679-7425-40de-944b-e07fc1f90ae7"
      },
      "timestamp": "2026-01-06T10:00:00Z",
      "schema_version": "1.0.0"
    },
    {
      "event_type": "task.completed",
      "event_id": "234e5678-f90c-23e4-b567-537725285111",
      "task_id": "550e8400-e29b-41d4-a716-446655440000",
      "user_id": "user-123",
      "task_data": {
        "title": "Weekly team meeting",
        "description": "Discuss project progress and blockers",
        "completed": true,
        "priority": "high",
        "tags": ["work", "meetings"],
        "due_date": "2026-01-13T10:00:00Z",
        "recurrence_id": "7c9e6679-7425-40de-944b-e07fc1f90ae7"
      },
      "timestamp": "2026-01-13T11:30:00Z",
      "schema_version": "1.0.0"
    },
    {
      "event_type": "task.deleted",
      "event_id": "345e6789-g01d-34f5-c678-648836396222",
      "task_id": "550e8400-e29b-41d4-a716-446655440000",
      "user_id": "user-123",
      "task_data": {
        "title": "Weekly team meeting",
        "description": "Discuss project progress and blockers",
        "completed": true,
        "priority": "high",
        "tags": ["work", "meetings"],
        "due_date": null,
        "recurrence_id": null
      },
      "timestamp": "2026-01-13T12:00:00Z",
      "schema_version": "1.0.0"
    }
  ],
  "definitions": {
    "priority": {
      "description": "Task priority levels",
      "enum": ["low", "normal", "high", "critical"]
    }
  }
}
